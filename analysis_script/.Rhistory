# find temperature optimum and remove bad curves (similar to leaf analysis)
source('~/Documents/Git/stem_root/analysis/stem_root_analysis_v6.0.R')
setwd('/Users/nicksmith/Documents/Git/stem_root/analysis')
# load up fits
stem_fits = read.csv('../data/stem_fits_v3.csv')
root_fits = read.csv('../data/root_fits_v3.csv')
leaf_fits = read.csv('../data/leaf_fits_v3.csv')
# find R25 values
stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
# find temperature optimum and remove bad curves (similar to leaf analysis)
stem_fits$topt_stem_mass = -stem_fits$b_stem_mass / (2 * stem_fits$c_stem_mass)
root_fits$topt_root_mass = -root_fits $b_root_mass / (2 * root_fits $c_root_mass)
leaf_fits$topt_leaf_mass = -leaf_fits $b_leaf_mass / (2 * leaf_fits $c_leaf_mass)
stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
nrow(stem_analysis)
nrow(stem_fits)
subset(stem_fits, r2_stem_mass < 0.01 | R25_stem_mass < 0.0002)
subset(root_fits, r2_root_mass < 0.01 | R25_root_mass < 0.0002)
setwd('/Users/nicksmith/Documents/Git/stem_root/data_pub_prep')
stem_root = read.csv('Stem_root_raw.csv')
stem_root$genus[stem_root$Species == 'B.alleghaniensis'] = 'Betula'
stem_root$genus[stem_root$Species == 'C.sativa'] = 'Cucumis'
stem_root$genus[stem_root$Species == 'G.max'] = 'Glycine'
stem_root$genus[stem_root$Species == 'P.nigra'] = 'Pinus'
stem_root$genus[stem_root$Species == 'P.pinaster'] = 'Pinus'
stem_root$genus[stem_root$Species == 'P.pinea'] = 'Pinus'
stem_root$genus[stem_root$Species == 'P.sylvestris'] = 'Pinus'
stem_root$genus[stem_root$Species == 'Z.mays'] = 'Zea'
stem_root$species[stem_root$Species == 'B.alleghaniensis'] = 'alleghaniensis'
stem_root$species[stem_root$Species == 'C.sativa'] = 'sativa'
stem_root$species[stem_root$Species == 'G.max'] = 'max'
stem_root$species[stem_root$Species == 'P.nigra'] = 'nigra'
stem_root$species[stem_root$Species == 'P.pinaster'] = 'pinaster'
stem_root$species[stem_root$Species == 'P.pinea'] = 'pinea'
stem_root$species[stem_root$Species == 'P.sylvestris'] = 'sylvestris'
stem_root$species[stem_root$Species == 'Z.mays'] = 'mays'
stem_root$Stem_Tmeas2 = stem_root$Stem_Tmeas^2
stem_root$Root_Tmeas2 = stem_root$Root_Tmeas^2
stem_root$individual = as.factor(paste(stem_root$genus, stem_root$species, stem_root$GrowthT, stem_root$Rep, sep = ''))
# convert mass data to correct units
stem_root$Stem_Rmass = stem_root$Stem_Rmass / 10000
stem_root$Root_Rmass = stem_root$Root_Rmass / 10000
stem = subset(stem_root, species != 'mays')
#root = stem_root[-c(426:430),]
root = stem_root
stem$Stem_Rarea[stem$Stem_Rarea >= 0] = NA
root$Root_Rarea[root$Root_Rarea >= 0] = NA
stem$Stem_Rmass[stem$Stem_Rmass >= 0] = NA
root$Root_Rmass[root$Root_Rmass >= 0] = NA
stem_sub = subset(stem, individual != "Pinussylvestris20r3" & individual != "Glycinemax35r2" &
individual != "Pinusnigra30r2" & individual != "Pinussylvestris15r2" & individual != "Cucumissativa25r3")
root_sub = subset(root, individual != "Pinussylvestris20r3" & individual != "Glycinemax35r2" &
individual != "Pinusnigra30r2" & individual != "Pinussylvestris15r2" & individual != "Cucumissativa25r3")
# clean based on bad fit stats
stem_fits = read.csv('../data/stem_fits_v3.csv')
root_fits = read.csv('../data/root_fits_v3.csv')
leaf_fits = read.csv('../data/leaf_fits_v3.csv')
## leaves
leaf_all = read.csv('RTall.041415.csv')
leaf = subset(leaf_all, RootStem == 'Y')
leaf$Rarea[stem$Rarea >= 0] = NA
leaf$Rmass[stem$Rmass >= 0] = NA
# convert Rmass data to correct units
leaf$Rmass = leaf$Rmass / 10000
leaf$individual = as.factor(paste(leaf$Genus, leaf$Species, leaf$GrowthT, leaf$Rep, sep = ''))
leaf$LeafT2 = leaf$LeafT**2
leaf_sub = subset(leaf, individual != "Pinussylvestris20r3" & individual != "Glycinemax35r2" &
individual != "Pinusnigra30r2" & individual != "Pinussylvestris15r2" & individual != "Cucumissativa25r3")
stem_sub_stats = left_join(stem_sub, stem_fits)
head
hgead(stem_sub_stats)
head(stem_sub_stats)
head(stem_fits)
head(stem_sub)
stem_sub_stats = left_join(stem_sub, stem_fits)
stem_fit$individual1 = paste(stem_fits$genus, stem_fits$species, stem_fits$GrowthT, sep = '')
stem_fits$individual1 = paste(stem_fits$genus, stem_fits$species, stem_fits$GrowthT, sep = '')
stem_fits$individual = paste(stem_fits$individual1, stem_fits$Rep, sep = 'r')
stem_fits$individual
stem_fits$individual1 = paste(stem_fits$genus, stem_fits$species, stem_fits$GrowthT, sep = '')
stem_fits$individual = paste(stem_fits$individual1, stem_fits$Rep, sep = 'r')
root_fits$individual1 = paste(root_fits$genus, root_fits$species, root_fits$GrowthT, sep = '')
root_fits$individual = paste(root_fits$individual1, root_fits$Rep, sep = 'r')
leaf_fits$individual1 = paste(leaf_fits$genus, leaf_fits$species, leaf_fits$GrowthT, sep = '')
leaf_fits$individual = paste(leaf_fits$individual1, leaf_fits$Rep, sep = 'r')
stem_sub_stats = left_join(stem_sub, stem_fits[ , c('individual', 'r2_stem_mass', 'R25_stem_mass')])
stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
stem_sub_stats = left_join(stem_sub, stem_fits[ , c('individual', 'r2_stem_mass', 'R25_stem_mass')])
head(stem_sub_stats)
stem_sub_stats = left_join(stem_sub, stem_fits[ , c('individual', 'r2_stem_mass', 'R25_stem_mass')])
root_sub_stats = left_join(root_sub, root_fits[ , c('individual', 'r2_root_mass', 'R25_root_mass')])
leaf_sub_stats = left_join(leaf_sub, leaf_fits[ , c('individual', 'r2_leaf_mass', 'R25_leaf_mass')])
stem_sub_sub = subset(stem_sub_stats, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)[ , -c('r2_stem_mass', 'R25_stem_mass')]
subset(stem_sub_stats, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
stem_sub_sub = subset(stem_sub_stats, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)[  , -c('r2_stem_mass', 'R25_stem_mass')]
head(stem_sub_stats)
colnames(stem_sub_stats)
stem_sub_sub = subset(stem_sub_stats, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)[  , -c(16:17)]
head(stem_sub_sub)
stem_sub_sub = subset(stem_sub_stats, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)[  , -c(16:17)]
root_sub_sub = subset(root_sub_stats, r2_root_mass > 0.01 & R25_root_mass > 0.0002)[  , -c(16:17)]
leaf_sub_sub = subset(leaf_sub_stats, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)[  , -c(16:17)]
write.csv(stem_sub, 'raw_clean/stem_raw.csv')
write.csv(root_sub, 'raw_clean/root_raw.csv')
write.csv(leaf_sub, 'raw_clean/leaf_raw.csv')
setwd('/Users/nicksmith/Documents/Git/tissue_respiration/curve_fitting_script')
stem = read.csv('../raw_data/stem_raw.csv')
root = read.csv('../raw_data/root_raw.csv')
leaf = read.csv('../raw_data/leaf_raw.csv')
stem_sub = subset(stem, Stem_Rarea <= 0 & Stem_Rmass <= 0)
root_sub = subset(root, Root_Rarea <= 0 & Root_Rmass <= 0)
stem_sub$individual = as.factor(paste(stem_sub$genus, stem_sub$species, stem_sub$GrowthT, stem_sub$Rep, sep = ''))
root_sub$individual = as.factor(paste(root_sub$genus, root_sub$species, root_sub$GrowthT, root_sub$Rep, sep = ''))
individuals_stem = levels(stem_sub$individual)
individuals_root = levels(root_sub$individual)
leaf_sub = subset(leaf, Rarea >= 0 & Rmass >= 0)
leaf_sub$individual = as.factor(paste(leaf_sub$Genus, leaf_sub$Species, leaf_sub$GrowthT, leaf_sub$Rep, sep = ''))
individuals_leaf = levels(leaf_sub$individual)
# fit each curve and put in dataframe
stem_fits = c()
for(i in 1:length(individuals_stem)){
fit = lm(log(-Stem_Rarea) ~ Stem_Tmeas + Stem_Tmeas2, data = subset(stem, individual == individuals_stem[i]))
summary = summary(fit)
fit_mass = lm(log(-Stem_Rmass) ~ Stem_Tmeas + Stem_Tmeas2, data = subset(stem, individual == individuals_stem[i]))
summary_mass = summary(fit_mass)
data = c(subset(stem, individual == individuals_stem[i])$genus[1], subset(stem, individual == individuals_stem[i])$species[1], subset(stem, individual == individuals_stem[i])$GrowthT[1], subset(stem, individual == individuals_stem[i])$Rep[1], summary$coefficients[1], summary$coefficients[2], summary$coefficients[3], sqrt(mean(summary$residuals^2)), summary$adj.r.squared, summary_mass$coefficients[1], summary_mass$coefficients[2], summary_mass$coefficients[3], sqrt(mean(summary_mass$residuals^2)), summary_mass$adj.r.squared)
stem_fits = rbind(stem_fits, data)
}
colnames(stem_fits) = c('genus', 'species', 'GrowthT', 'Rep', 'a_stem_area', 'b_stem_area', 'c_stem_area', 'RMSE_stem_area', 'r2_stem_area', 'a_stem_mass', 'b_stem_mass', 'c_stem_mass', 'RMSE_stem_mass', 'r2_stem_mass')
root_fits = c()
for(i in 1:length(individuals_root)){
fit = lm(log(-Root_Rarea) ~ Root_Tmeas + Root_Tmeas2, data = subset(root, individual == individuals_root[i]))
summary = summary(fit)
fit_mass = lm(log(-Root_Rmass) ~ Root_Tmeas + Root_Tmeas2, data = subset(root, individual == individuals_root[i]))
summary_mass = summary(fit_mass)
data = c(subset(root, individual == individuals_root[i])$genus[1], subset(root, individual == individuals_root[i])$species[1], subset(root, individual == individuals_root[i])$GrowthT[1], subset(root, individual == individuals_root[i])$Rep[1], summary$coefficients[1], summary$coefficients[2], summary$coefficients[3], sqrt(mean(summary$residuals^2)), summary$adj.r.squared, summary_mass$coefficients[1], summary_mass$coefficients[2], summary_mass$coefficients[3], sqrt(mean(summary_mass$residuals^2)), summary_mass$adj.r.squared)
root_fits = rbind(root_fits, data)
}
colnames(root_fits) = c('genus', 'species', 'GrowthT', 'Rep', 'a_root_area', 'b_root_area', 'c_root_area', 'RMSE_root_area', 'r2_root_area', 'a_root_mass', 'b_root_mass', 'c_root_mass', 'RMSE_root_mass', 'r2_root_mass')
leaf_fits = c()
for(i in 1:length(individuals_leaf)){
fit = lm(log(Rarea) ~ LeafT + LeafT2, data = subset(leaf, individual == individuals_leaf[i]))
summary = summary(fit)
fit_mass = lm(log(Rmass) ~ LeafT + LeafT2, data = subset(leaf, individual == individuals_leaf[i]))
summary_mass = summary(fit_mass)
data = c(as.character(subset(leaf, individual == individuals_leaf[i])$Genus[1]), as.character(subset(leaf, individual == individuals_leaf[i])$Species[1]), subset(leaf, individual == individuals_leaf[i])$GrowthT[1], subset(leaf, individual == individuals_leaf[i])$Rep[1], summary$coefficients[1], summary$coefficients[2], summary$coefficients[3], sqrt(mean(summary$residuals^2)), summary$adj.r.squared, summary_mass$coefficients[1], summary_mass$coefficients[2], summary_mass$coefficients[3], sqrt(mean(summary_mass$residuals^2)), summary_mass$adj.r.squared)
leaf_fits = rbind(leaf_fits, data)
}
colnames(leaf_fits) = c('genus', 'species', 'GrowthT', 'Rep', 'a_leaf_area', 'b_leaf_area', 'c_leaf_area', 'RMSE_leaf_area', 'r2_leaf_area', 'a_leaf_mass', 'b_leaf_mass', 'c_leaf_mass', 'RMSE_leaf_mass', 'r2_leaf_mass')
# write new data frames
#write.csv(stem_fits, '../tresp_curve_fits/stem_fits_v3.csv')
#write.csv(root_fits, '../tresp_curve_fits/root_fits_v3.csv')
#write.csv(leaf_fits, '../tresp_curve_fits/leaf_fits_v3.csv')
write.csv(stem_fits, '../tresp_curve_fits/stem_fits_v3.csv')
write.csv(root_fits, '../tresp_curve_fits/root_fits_v3.csv')
write.csv(leaf_fits, '../tresp_curve_fits/leaf_fits_v3.csv')
setwd('/Users/nicksmith/Documents/Git/tissue_respiration/analysis_script')
stem_fits = read.csv('../data/stem_fits_v3.csv')
root_fits = read.csv('../data/root_fits_v3.csv')
leaf_fits = read.csv('../data/leaf_fits_v3.csv')
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
nrow(stem_fits)
nrow(stem_analysis)
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
nrow(stem_analysis)
nrow(stem_fits)
nrow(root_fits)
nrow(root_analysis)
root_analysis = subset(root_fits, r2_root_mass > 0.01 & R25_root_mass > 0.0002)
leaf_analysis = subset(leaf_fits, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)
nrow(root_analysis)
nrow(leaf_analysis)
nrow(leaf_fits)
all_analysis1 = full_join(stem_analysis, root_analysis, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis2 = full_join(all_analysis1, leaf_analysis, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis2_zm = subset(all_analysis2, genus == 'Zea')
all_analysis2_other = subset(all_analysis2, genus != 'Zea')
all_analysis2_zm1 = subset(all_analysis2_zm, r2_root_mass > 0 & r2_leaf_mass > 0)
all_analysis2_other1 = subset(all_analysis2_other, r2_root_mass > 0 & r2_leaf_mass > 0 & r2_stem_mass > 0)
all_analysis = rbind(all_analysis2_other1, all_analysis2_zm1)
all_analysis1 = full_join(stem_analysis, root_analysis, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis2 = full_join(all_analysis1, leaf_analysis, by = c('genus', 'species', 'GrowthT', 'Rep'))
head(leaf_analysis)
head(all_analysis1)
head(stem_analysis)
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
head(all_analysis1)
head(stem_fits)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis2_zm = subset(all_analysis2, genus == 'Zea')
all_analysis2_other = subset(all_analysis2, genus != 'Zea')
all_analysis2_zm1 = subset(all_analysis2_zm, r2_root_mass > 0 & r2_leaf_mass > 0)
all_analysis2_other1 = subset(all_analysis2_other, r2_root_mass > 0 & r2_leaf_mass > 0 & r2_stem_mass > 0)
all_analysis_old = rbind(all_analysis2_other1, all_analysis2_zm1)
nrow(all_analysis_old)
nrow(all_analysis)
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
nrow(all_analysis)
nrow(stem_fits)
nrow(root_fits)
nrow(leaf_fits)
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
# # find R25 values
# stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
# root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
# leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
#
# # find temperature optimum and remove bad curves (similar to leaf analysis)
# # stem_fits$topt_stem_mass = -stem_fits$b_stem_mass / (2 * stem_fits$c_stem_mass)
# # root_fits$topt_root_mass = -root_fits $b_root_mass / (2 * root_fits $c_root_mass)
# # leaf_fits$topt_leaf_mass = -leaf_fits $b_leaf_mass / (2 * leaf_fits $c_leaf_mass)
#
# stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
# root_analysis = subset(root_fits, r2_root_mass > 0.01 & R25_root_mass > 0.0002)
# leaf_analysis = subset(leaf_fits, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
write.csv(all_analysis, '~/Desktop/all_analysis_bad.csv')
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
# # find R25 values
# stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
# root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
# leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
#
# # find temperature optimum and remove bad curves (similar to leaf analysis)
# # stem_fits$topt_stem_mass = -stem_fits$b_stem_mass / (2 * stem_fits$c_stem_mass)
# # root_fits$topt_root_mass = -root_fits $b_root_mass / (2 * root_fits $c_root_mass)
# # leaf_fits$topt_leaf_mass = -leaf_fits $b_leaf_mass / (2 * leaf_fits $c_leaf_mass)
#
# stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
# root_analysis = subset(root_fits, r2_root_mass > 0.01 & R25_root_mass > 0.0002)
# leaf_analysis = subset(leaf_fits, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
nrow(all_analysis)
head(all_analysis)
subset(all_analysis, genus == 'Cucumis')
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
# # find R25 values
# stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
# root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
# leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
#
# # find temperature optimum and remove bad curves (similar to leaf analysis)
# # stem_fits$topt_stem_mass = -stem_fits$b_stem_mass / (2 * stem_fits$c_stem_mass)
# # root_fits$topt_root_mass = -root_fits $b_root_mass / (2 * root_fits $c_root_mass)
# # leaf_fits$topt_leaf_mass = -leaf_fits $b_leaf_mass / (2 * leaf_fits $c_leaf_mass)
#
# stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
# root_analysis = subset(root_fits, r2_root_mass > 0.01 & R25_root_mass > 0.0002)
# leaf_analysis = subset(leaf_fits, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
nrow(all_analysis)
stem_mass = all_analysis[ , c(2:5, 11:17)]
root_mass = all_analysis[ , c(2:5, 24:30)]
leaf_mass = all_analysis[ , c(2:5, 37:43)]
stem_mass$tissue = 'stem'
root_mass$tissue = 'root'
leaf_mass$tissue = 'leaf'
colnames(stem_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(leaf_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(root_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
all_mass = rbind(stem_mass, root_mass, leaf_mass)
all_mass$individual = paste(all_mass$genus, all_mass$species, all_mass$GrowthT, all_mass$Rep, sep = '_')
# remove individuals with bad points
all_mass_sub = subset(all_mass, individual != "Pinus_sylvestris_20_3" & individual != "Glycine_max_35_2" & individual != "Pinus_nigra_30_2" & individual != "Pinus_sylvestris_15_2" & individual != "Cucumis_sativa_25_3")
# add in plant type characteristics
all_mass_sub$lifespan = 'annual'
all_mass_sub$lifespan[all_mass_sub$genus == 'Pinus' | all_mass_sub$genus == 'Betula'] = 'perennial'
# fit statistics
mean(subset(all_mass_sub, tissue == 'leaf')$r2_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'stem')$r2_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'root')$r2_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'leaf')$RMSE_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'stem')$RMSE_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'root')$RMSE_mass, na.rm = T)
# count individuals per species per GrowthT
all_mass_sub$GrowthTfac = as.factor(all_mass_sub$GrowthT)
all_mass_sub_group = group_by(all_mass_sub, GrowthTfac, genus, species, tissue)
all_mass_sub_count = summarise(all_mass_sub_group, n = n())
# write.csv(subset(all_mass_sub_count, tissue == 'leaf'), '/Users/nicksmith/Documents/Research/Thesis/Growth chamber/Stem_Root/Analysis/all_mass_sub_count.csv') # only leaf subset because leaf, stem, root are all the same
# save for publishing dataset later
# save.image('/Users/nicksmith/Documents/Research/Thesis/Growth chamber/Stem_Root/Analysis/stem_root_dataset.Rdata')
# separate by photosynthetic and non-photosynthetic tissue
all_mass_sub$ps_tis = 'no'
all_mass_sub$ps_tis[all_mass_sub$species == 'max' & all_mass_sub$tissue == 'stem'] = 'yes'
all_mass_sub$ps_tis[all_mass_sub$species == 'sativa' & all_mass_sub$tissue == 'stem'] = 'yes'
all_mass_sub$ps_tis[all_mass_sub$tissue == 'leaf'] = 'yes'
all_mass_sub$tissue_ps = paste(all_mass_sub$tissue, all_mass_sub$ps_tis, sep = '_')
stem_mass = all_analysis[ , c(2:5, 11:17)]
root_mass = all_analysis[ , c(2:5, 24:30)]
leaf_mass = all_analysis[ , c(2:5, 37:43)]
stem_mass$tissue = 'stem'
root_mass$tissue = 'root'
leaf_mass$tissue = 'leaf'
colnames(stem_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(leaf_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(root_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
all_mass = rbind(stem_mass, root_mass, leaf_mass)
all_mass$individual = paste(all_mass$genus, all_mass$species, all_mass$GrowthT, all_mass$Rep, sep = '_')
# remove individuals with bad points
all_mass_sub = subset(all_mass, individual != "Pinus_sylvestris_20_3" & individual != "Glycine_max_35_2" & individual != "Pinus_nigra_30_2" & individual != "Pinus_sylvestris_15_2" & individual != "Cucumis_sativa_25_3")
# add in plant type characteristics
all_mass_sub$lifespan = 'annual'
all_mass_sub$lifespan[all_mass_sub$genus == 'Pinus' | all_mass_sub$genus == 'Betula'] = 'perennial'
head(all_analysis)
colnames(all_analysis)
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
head(all_analysis)
library(lme4)
library(car)
library(emmeans)
library(tidyverse)
library(dplyr)
library(gtable)
library(grid)
library(simr)
# load up fits
stem_fits = read.csv('../tresp_curve_fits/stem_fits_v3.csv')
root_fits = read.csv('../tresp_curve_fits/root_fits_v3.csv')
leaf_fits = read.csv('../tresp_curve_fits/leaf_fits_v3.csv')
# # find R25 values
# stem_fits$R25_stem_mass = exp(stem_fits$a_stem_mass + stem_fits$b_stem_mass * 25 + stem_fits$c_stem_mass * 25^2)
# root_fits$R25_root_mass = exp(root_fits$a_root_mass + root_fits$b_root_mass * 25 + root_fits$c_root_mass * 25^2)
# leaf_fits$R25_leaf_mass = exp(leaf_fits$a_leaf_mass + leaf_fits$b_leaf_mass * 25 + leaf_fits$c_leaf_mass * 25^2)
#
# # find temperature optimum and remove bad curves (similar to leaf analysis)
# # stem_fits$topt_stem_mass = -stem_fits$b_stem_mass / (2 * stem_fits$c_stem_mass)
# # root_fits$topt_root_mass = -root_fits $b_root_mass / (2 * root_fits $c_root_mass)
# # leaf_fits$topt_leaf_mass = -leaf_fits $b_leaf_mass / (2 * leaf_fits $c_leaf_mass)
#
# stem_analysis = subset(stem_fits, r2_stem_mass > 0.01 & R25_stem_mass > 0.0002)
# root_analysis = subset(root_fits, r2_root_mass > 0.01 & R25_root_mass > 0.0002)
# leaf_analysis = subset(leaf_fits, r2_leaf_mass > 0.01 & R25_leaf_mass > 0.0002)
all_analysis1 = full_join(stem_fits, root_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
#all_analysis2 = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
all_analysis = full_join(all_analysis1, leaf_fits, by = c('genus', 'species', 'GrowthT', 'Rep'))
head(all_analysis)
colnames(all_analysis)
stem_mass = all_analysis[ , c(2:5, 11:15)]
root_mass = all_analysis[ , c(2:5, 22:26)]
leaf_mass = all_analysis[ , c(2:5, 33:37)]
stem_mass$tissue = 'stem'
root_mass$tissue = 'root'
leaf_mass$tissue = 'leaf'
colnames(stem_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(leaf_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(root_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "R25_mass", "topt_mass", "tissue")
colnames(stem_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "tissue")
colnames(leaf_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "tissue")
colnames(root_mass) = c("genus", "species", "GrowthT", "Rep", "a_mass", "b_mass", "c_mass", "RMSE_mass", "r2_mass", "tissue")
all_mass = rbind(stem_mass, root_mass, leaf_mass)
all_mass$individual = paste(all_mass$genus, all_mass$species, all_mass$GrowthT, all_mass$Rep, sep = '_')
# add in plant type characteristics
all_mass_sub$lifespan = 'annual'
all_mass_sub = rbind(stem_mass, root_mass, leaf_mass)
all_mass_sub$individual = paste(all_mass$genus, all_mass$species, all_mass$GrowthT, all_mass$Rep, sep = '_')
all_mass_sub = rbind(stem_mass, root_mass, leaf_mass)
all_mass_sub$individual = paste(all_mass$genus, all_mass$species, all_mass$GrowthT, all_mass$Rep, sep = '_')
# add in plant type characteristics
all_mass_sub$lifespan = 'annual'
all_mass_sub$lifespan[all_mass_sub$genus == 'Pinus' | all_mass_sub$genus == 'Betula'] = 'perennial'
# fit statistics
mean(subset(all_mass_sub, tissue == 'leaf')$r2_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'leaf')$RMSE_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'stem')$RMSE_mass, na.rm = T)
mean(subset(all_mass_sub, tissue == 'root')$RMSE_mass, na.rm = T)
# count individuals per species per GrowthT
all_mass_sub$GrowthTfac = as.factor(all_mass_sub$GrowthT)
all_mass_sub_group = group_by(all_mass_sub, GrowthTfac, genus, species, tissue)
all_mass_sub_count = summarise(all_mass_sub_group, n = n())
all_mass_sub_count
all_mass_sub$ps_tis = 'no'
all_mass_sub$ps_tis[all_mass_sub$species == 'max' & all_mass_sub$tissue == 'stem'] = 'yes'
all_mass_sub$ps_tis[all_mass_sub$species == 'sativa' & all_mass_sub$tissue == 'stem'] = 'yes'
all_mass_sub$ps_tis[all_mass_sub$tissue == 'leaf'] = 'yes'
all_mass_sub$tissue_ps = paste(all_mass_sub$tissue, all_mass_sub$ps_tis, sep = '_')
#MM analyses
# a_lm = lmer(a_mass ~ GrowthT * tissue + (1|species) + (1|individual), data = all_mass_sub)
a_lm = lmer(a_mass ~ GrowthT * tissue_ps + species + (1|individual) , data = all_mass_sub)
summary(a_lm)
#MM analyses
# a_lm = lmer(a_mass ~ GrowthT * tissue + (1|species) + (1|individual), data = all_mass_sub)
a_lm = lmer(a_mass ~ GrowthT * tissue_ps + species + (1|individual) , data = all_mass_sub)
summary(a_lm)
Anova(a_lm) #
cld(emmeans(a_lm, ~species))
Anova(a_lm) #
cld(emmeans(a_lm, ~species))
a_lm_lsm = emtrends(a_lm, ~ tissue_ps, var = 'GrowthT')
test(a_lm_lsm) #
Anova(a_lm) #
# add in photosynthetic data
gc_data=read.csv('../raw_data/gc_data_merged.csv')
gc_data$individual = paste(gc_data$Genus, gc_data$Species, gc_data$GrowthT, gc_data$Rep, sep = '_')
gc_data_rm = gc_data[-c(189:199, 334:362), ] #remove all non-measured Zea mays and Pinus sylvestris
all_mass_sub_ps_leaf = left_join(subset(all_mass_sub, tissue == 'leaf'), gc_data_rm, by = c('individual'))
all_mass_sub_ps_stem = left_join(subset(all_mass_sub, tissue == 'stem'), gc_data_rm, by = c('individual'))
all_mass_sub_ps_root = left_join(subset(all_mass_sub, tissue == 'root'), gc_data_rm, by = c('individual'))
all_mass_sub_ps = rbind(all_mass_sub_ps_leaf, all_mass_sub_ps_stem, all_mass_sub_ps_root)
all_mass_sub_ps$vcmax_acc_area = exp(all_mass_sub_ps$a_Vcmax + all_mass_sub_ps$b_Vcmax * all_mass_sub_ps$GrowthT.y + all_mass_sub_ps$c_Vcmax * (all_mass_sub_ps$GrowthT.y ^2))
all_mass_sub_ps$vcmax_acc_mass = all_mass_sub_ps$vcmax_acc_area * ((all_mass_sub_ps$Larea_P * 0.0001) / all_mass_sub_ps$Lmass_P)
all_mass_sub_ps$rd_acc_mass = exp(all_mass_sub_ps$a_mass + all_mass_sub_ps$b_mass * all_mass_sub_ps$GrowthT.x + all_mass_sub_ps$c_mass * (all_mass_sub_ps$GrowthT.x ^2))
all_mass_sub_ps$rdvcmax_acc_mass = all_mass_sub_ps$rd_acc_mass / all_mass_sub_ps$vcmax_acc_mass
rdvcmax_lm = lmer(log(rdvcmax_acc_mass) ~ GrowthT.x * tissue_ps + species +
(1|individual),
data = subset(all_mass_sub_ps, rdvcmax_acc_mass < 1 & rdvcmax_acc_mass > 0))
